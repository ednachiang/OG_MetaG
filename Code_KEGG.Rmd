---
title: "KEGG Code"
author: "Edna Chiang"
date: "2/9/2021"
output: html_document
---

### Load Libraries
```{r}
library('readr')
library('pgirmess')
library('ggplot2')
library('grid')
library('phyloseq')
library('DESeq2')
library('phangorn')
library('vegan')
library('pheatmap')
library('RColorBrewer')
library('gplots')
library('tidyr')
library('dplyr')
library('stringr')
library('lme4')
library('picante')
library('ggdendro')
library('fitdistrplus')
theme_set(theme_bw())
set.seed(1)
```

### Load Functions
```{r}
source('scripts/misc.R')
source('scripts/simper.R')
source('scripts/pairwise.adonis.R')
```




### KEGG - Kruskal-Wallis
```{r}
# Load data
kegg1 <- read.csv('KEGG/musicc_outputs/KEGG_MUSiCC_all1.tab', header=T, sep = "\t")
kegg2 <- read.csv('KEGG/musicc_outputs/KEGG_MUSiCC_all2.tab', header=T, sep = "\t")
kegg3 <- read.csv('KEGG/musicc_outputs/KEGG_MUSiCC_all3.tab', header=T, sep = "\t")
kegg4 <- read.csv('KEGG/musicc_outputs/KEGG_MUSiCC_all4.tab', header=T, sep = "\t")

# Format data
kegg1.df <- data.frame(t(kegg1))
colnames(kegg1.df) <- kegg1.df[1,]
kegg1.df <- kegg1.df[-1,]
rownames(kegg1.df) <- c("3715", "3717", "3723", "3733", "3734", "3744", "3772", "3773", "3775")
kegg1.df$Season <- c("Summer", "Summer", "Winter", "Winter", "Spring", "Summer", "Winter", "Spring", "Spring")
kegg1.df$Season <- ordered(kegg1.df$Season, levels=c("Summer", "Winter", "Spring"))

kegg2.df <- data.frame(t(kegg2))
colnames(kegg2.df) <- kegg2.df[1,]
kegg2.df <- kegg2.df[-1,]
rownames(kegg2.df) <- c("3715", "3717", "3723", "3733", "3734", "3744", "3772", "3773", "3775")
kegg2.df$Season <- c("Summer", "Summer", "Winter", "Winter", "Spring", "Summer", "Winter", "Spring", "Spring")
kegg2.df$Season <- ordered(kegg2.df$Season, levels=c("Summer", "Winter", "Spring"))

kegg3.df <- data.frame(t(kegg3))
colnames(kegg3.df) <- kegg3.df[1,]
kegg3.df <- kegg3.df[-1,]
rownames(kegg3.df) <- c("3715", "3717", "3723", "3733", "3734", "3744", "3772", "3773", "3775")
kegg3.df$Season <- c("Summer", "Summer", "Winter", "Winter", "Spring", "Summer", "Winter", "Spring", "Spring")
kegg3.df$Season <- ordered(kegg3.df$Season, levels=c("Summer", "Winter", "Spring"))

kegg4.df <- data.frame(t(kegg4))
colnames(kegg4.df) <- kegg4.df[1,]
kegg4.df <- kegg4.df[-1,]
rownames(kegg4.df) <- c("3715", "3717", "3723", "3733", "3734", "3744", "3772", "3773", "3775")
kegg4.df$Season <- c("Summer", "Summer", "Winter", "Winter", "Spring", "Summer", "Winter", "Spring", "Spring")
kegg4.df$Season <- ordered(kegg4.df$Season, levels=c("Summer", "Winter", "Spring"))


# Run Kruskal-Wallis on normalized KEGG counts
kegg1.kw <- data.frame(matrix(nrow = 1, ncol = nrow(kegg1)))
colnames(kegg1.kw) <- kegg1[,1]
for(i in 1:nrow(kegg1.df)){
  koid <- colnames(kegg1.df)[i]
  kw <- kruskal.test(formula = reformulate("Season", koid), data = kegg1.df)
  kegg1.kw[,i] <- kw$p.value
}
kegg1.kw[2,] <- p.adjust(kegg1.kw[1,], method = "fdr")
which(kegg1.kw[2,] < 0.05)

kegg2.kw <- data.frame(matrix(nrow = 1, ncol = nrow(kegg2)))
colnames(kegg2.kw) <- kegg2[,1]
for(i in 1:nrow(kegg2.df)){
  koid <- colnames(kegg2.df)[i]
  kw <- kruskal.test(formula = reformulate("Season", koid), data = kegg2.df)
  kegg2.kw[,i] <- kw$p.value
}
kegg2.kw[2,] <- p.adjust(kegg2.kw[1,], method = "fdr")
which(kegg2.kw[2,] < 0.05)

kegg3.kw <- data.frame(matrix(nrow = 1, ncol = nrow(kegg3)))
colnames(kegg3.kw) <- kegg3[,1]
for(i in 1:nrow(kegg3.df)){
  koid <- colnames(kegg3.df)[i]
  kw <- kruskal.test(formula = reformulate("Season", koid), data = kegg3.df)
  kegg3.kw[,i] <- kw$p.value
}
kegg3.kw[2,] <- p.adjust(kegg3.kw[1,], method = "fdr")
which(kegg3.kw[2,] < 0.05)

kegg4.kw <- data.frame(matrix(nrow = 1, ncol = nrow(kegg4)))
colnames(kegg4.kw) <- kegg4[,1]
for(i in 1:nrow(kegg4.df)){
  koid <- colnames(kegg4.df)[i]
  kw <- kruskal.test(formula = reformulate("Season", koid), data = kegg4.df)
  kegg4.kw[,i] <- kw$p.value
}
kegg4.kw[2,] <- p.adjust(kegg4.kw[1,], method = "fdr")
which(kegg4.kw[2,] < 0.05)
```